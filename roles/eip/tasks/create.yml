---
- name: "[ {{ attach.id }} - {{ eip.name }} ] Creating EIP"
  ali_eip:
    alicloud_access_key: '{{ access_key }}'
    alicloud_secret_key: '{{ secret_key }}'
    alicloud_region: '{{ region }}'
    instance_id: '{{ attach.id }}'
    name: '{{ eip.name }}'
    internet_charge_type: '{{ eip.charge_type }}'
    bandwidth: '{{ eip.bandwidth }}'
    allow_reassociation: true
    release_on_disassociation: false
    reuse_existing_ip_allowed: false
    state: present
  when:
    - ieip.eips.0.id is not defined
  register: ceip

- name: "[ {{ attach.id }} - {{ eip.name }} ] Tagging EIP"
  ali_vpc_tag:
    alicloud_access_key: '{{ access_key }}'
    alicloud_secret_key: '{{ secret_key }}'
    alicloud_region: '{{ region }}'
    resource_ids: '{{ ceip.eip.id }}'
    resource_type: eip
    tags: '{{ tags }}'
    state: present
  when:
    - ieip.eips.0.id is not defined
